# 紧急操作指南 - 解决 JSON 解析错误

## 🔴 当前问题
Unity 仍然报告 JSON 解析错误，即使文件已经是干净的。这可能是由于：

1. **Unity 缓存了旧的错误版本**
2. **文件权限或锁定问题**
3. **Unity 内部状态问题**

## 🚨 立即执行的紧急操作

### 方案 A: 完全重启工作流（推荐）

#### 步骤 1: 完全关闭 Unity
1. 如果 Unity 还在运行，**完全退出**
2. 不要只是关闭窗口，要完全退出应用
3. 检查 Activity Monitor 确保没有 Unity 进程在运行

#### 步骤 2: 清理所有缓存
```bash
# 在终端执行这些命令
cd /Users/yuanweijie/Projects/EndangeredAnimalAR

# 1. 清理 Unity 全局缓存
rm -rf ~/Library/Caches/Unity/
rm -rf ~/Library/Unity/
rm -rf ~/Library/Application\ Support/Unity/

# 2. 清理项目缓存
rm -rf Library/ Temp/ Obj/

# 3. 验证 manifest.json
python3 -m json.tool Packages/manifest.json
```

#### 步骤 3: 重新打开 Unity
1. 通过 **Unity Hub** 重新打开项目
2. 或使用命令行: `open /Users/yuanweijie/Projects/EndangeredAnimalAR`
3. **不要**点击错误对话框中的任何按钮

### 方案 B: 创建全新项目（备用方案）

如果方案 A 仍然失败：
1. 在 Unity Hub 中创建**新项目**
2. 选择 **3D Core** 模板
3. 项目名称: `EndangeredAnimalAR_Fresh`
4. 位置: `/Users/yuanweijie/Projects/`

然后迁移核心文件：
```bash
# 复制核心文件到新项目
cp -r EndangeredAnimalAR/Assets/Scripts/ EndangeredAnimalAR_Fresh/Assets/
cp -r EndangeredAnimalAR/Assets/Scenes/ EndangeredAnimalAR_Fresh/Assets/
cp -r EndangeredAnimalAR/Assets/Resources/ EndangeredAnimalAR_Fresh/Assets/
```

### 方案 C: 使用 Unity 安全模式

1. 按住 **Option (Alt)** 键打开 Unity
2. 选择项目时选择 **Safe Mode**
3. Unity 会禁用所有包和插件
4. 然后手动重新导入包

## 🔧 技术诊断

### 检查当前 manifest.json 状态：
```bash
# 1. 检查文件大小
ls -la Packages/manifest.json

# 2. 检查文件内容（前10行）
head -10 Packages/manifest.json

# 3. 检查是否有隐藏字符
od -c Packages/manifest.json | head -20

# 4. 验证 JSON 格式
python3 -c "import json; json.load(open('Packages/manifest.json')); print('OK')"
```

### 预期结果：
- 文件大小: ~1.8KB
- 第一行: `{`
- 第二行: `  "dependencies": {`
- 没有 `//` 注释
- JSON 验证通过

## 📊 验证步骤

### 修复成功后：
1. ✅ Unity 正常启动，没有错误对话框
2. ✅ 包管理器开始导入包
3. ✅ Console 显示包导入进度
4. ✅ 项目开始编译

### 如果仍然失败：
1. **检查 Unity 版本** - 确保是 2022.3.62f3c1
2. **检查磁盘空间** - 确保有足够空间
3. **检查网络连接** - 包需要下载
4. **检查文件权限** - 确保有读写权限

## ⚠️ 重要注意事项

### 不要执行的操作：
- ❌ 不要修改 manifest.json 添加注释
- ❌ 不要使用文本编辑器可能添加 BOM
- ❌ 不要保留 Unity 缓存文件
- ❌ 不要点击错误对话框的 "Continue"（可能导致更多问题）

### 必须执行的操作：
- ✅ 完全退出 Unity
- ✅ 彻底清理缓存
- ✅ 验证 JSON 格式
- ✅ 重新打开项目

## 🆘 如果所有方案都失败

### 最后手段：
1. **重新安装 Unity** - 使用 Unity Hub 重新安装
2. **联系 Unity 支持** - 提供完整错误日志
3. **使用备份项目** - 恢复到可工作状态

### 提供的信息：
- Unity 版本: 2022.3.62f3c1
- 错误信息: "Unexpected token '/' in JSON"
- 已尝试: 清理缓存、验证 JSON、创建新文件
- 项目路径: `/Users/yuanweijie/Projects/EndangeredAnimalAR`

## 🎯 成功标准

修复成功后：
1. ✅ Unity 正常启动
2. ✅ 包正常导入
3. ✅ 项目正常编译
4. ✅ 没有 JSON 解析错误

---

**紧急修复时间**: 2026-02-18 13:32 GMT+8  
**当前状态**: JSON 解析错误（可能缓存问题）  
**推荐方案**: 完全重启 + 彻底清理缓存  
**预计耗时**: 3-5分钟